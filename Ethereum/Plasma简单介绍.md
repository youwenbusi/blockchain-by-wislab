# Plasma #
Plasma 是一种用于管理链下交易的技术，同时依靠底层的以太坊区块链来实现其安全性。但是 Plasma 采用了一种新思路，它是通过创建依附于“主”以太坊区块链的“子”区块链。这些子链又可以循序产生它们自己的子链，并能依次循环往复。

# Plasma运行原理 #
loom正在创建一个基于以太坊的卡牌交换游戏。这些卡牌是一些 ERC 721 不可替代的令牌（比如 Cryptokitties），但是拥有一些可以让玩家相互对战的特征和属性，这有点像炉石传说或者万智牌。这些类型的复杂操作在链上执行代价非常大，所以你决定在你的应用程序中使用 Plasma 作为替代方案。

首先，我们在以太坊主链上创建一系列的智能合约，它们可作为 Plasma 子链的“根节点”。Plasma 根节点包含了子链的一些基本“状态交易规则”（诸如“交易无法消费已消费过的资产”），也记录了子链状态的哈希值，并建立一种允许用户在以太坊主链和子链间转移资产的“桥接”服务。

然后，创建我们的子链。子链可以拥有自己的共识算法，在这个例子中，我们假设它使用了 Proof of Authority (PoA)，这是一种依赖可信区块生产者（比如，验证者）的简单共识机制。在“工作量证明”系统中，区块生产者和矿工的功能类似，它们接收交易，形成区块并收取交易费用的节点。为了让样例简单点，我们假设你（也就是创建游戏的公司）是创建区块的唯一实体，即你的公司运营几个节点，这些节点就是子链的区块生产者。

一旦子链创建好并生效后，区块生产者会周期性的向根节点合约发出提交。也就是他们实际上在说“我提交的 X 是子链中当前最新的区块”。这些提交被当做子链中事务的证明，记录在链上的 Plasma 根节点里。

现在子链也准备好了，我们可以创建卡牌交换游戏的基本组件。这些卡片遵循 ERC721，在以太坊主链上初始化，然后由 Plasma 根节点转移到子链上。这里引入了一个关键点：Plasma 可以扩展我们与基于区块链的数字资产之间的交互，但是这些资产应当是首先由以太坊主链创建的。然后，我们将实际的游戏应用程序以智能合约的方式部署到子链上，这样子链就包含了游戏所有的逻辑和规则。

当用户想要玩游戏时，他们只需要和子链进行交互。他们可以持有财产（ERC721 卡牌），为了以太币购买并交换它们，与其他用户对战，以及其他游戏中允许的行为，而这些过程都不需要与主链进行交互。因为只有很少的节点（比如，区块生产者）才需要处理交易，这样费用就会降低很多，操作也能更快。

# 安全性 #
通过将操作从主链迁移到子链上的方式，我们明显可以执行更多的操作了。但是这样安全吗？发生在子链上的交易是否具备权威性？毕竟，我们方才描述的系统只有一个中心实体控制着子链的区块生产。这样不是中心化吗？这样公司不是随时都能窃取你的资产或者拿走你的收藏卡牌吗？

简单来说，即使是在子链中完全由一个实体完全控制区块生产的情景下，Plasma 也能做出你可以随时将你的资产收回到主链上的基本承诺。如果一个区块生产者开始表现出敌意，最坏的情况也只是强迫你离开这个子链。

Plasma背后的主要安全机制称为“Plasma exits”，此安全机制将阻止已经参与Plasma链的用户继续在子链上进行操作，同时将用户的资金转移回至主链上。

当某个用户在Plasma链上进行交易并且想要将其资金转移到主链上时，只需提交一个“退出交易（exit transaction）”（即该用户交易历史的默克尔（Merkle）证明，以证明其拥有一定数量的资金）。提交之后，就会有一个“挑战期（challenge period）”。挑战机制在大多数链下解决方案（如比特币的闪电网络）中都能看到。实际上，你允许了任何人通过提交证明来挑战你的资产声明，他们可以证明你的声明无效或者过期（在Plasma中，这种证明可以是交易历史的默克尔证明，而在比特币的闪电网络中可能是一条由另一方签署的信息）。

此外，在进行可能会被挑战的交易时，还需要附加一笔小额奖励金，如果他人认为你存在恶意操作行为，就会对你进行挑战以获得相应的奖励。这就像是你试图偷东西，并说“如果你能抓到我，我就给你5美元。”

通常情况下，如果Bob想要将X个以太币（ETH）转移回主链上，他就需要提交一个“退出交易”（并附上奖励金作为抵押品），如果这个“退出交易”没有被挑战，那Bob就可以在主链上领取X个以太币（ETH）。但是如果Bob的“退出交易”被成功挑战了，那它就会被取消，同时挑战者会得到奖励金。因此，所有参与者没有了在子链上扩散无效区块的经济动力。

让我们来看下区块生产者表现恶劣的几种方式，同时看下 Plasma 会怎样处理这些情景。

首先，假设一个区块生产者试图通过说谎欺骗你，他们可以通过创建一个伪造的新区块，声称你的资产被他们接管了。由于他们是唯一的区块生产者，所以他们可以自由引入一个并不遵循区块链规则的新区块。和其他区块一样，他们也得将这个区块存在的证据作为提交推送给 Plasma 根节点合约。

如上所述，用户有能将他们的资产随时收回到主链上的基本保障。在这个情景下，用户（或者代表他们权益的应用程序）会侦测到这种盗窃的企图，并在区块生产者尝试和使用他们的“被盗”资产之前撤回到主链上。

Plasma 还创建了一种防止利用欺诈的机制。Plasma 包含了一种任何人（包括你）都可以向根节点合约发布欺诈证明（fraud proof）的机制，这样就可以证明区块生产者作弊了。这个欺诈证明会包含之前区块的信息，并且允许我们根据子链中的状态交易规则，错误的区块并不能正确接上之前的状态。如果欺诈被证实，则子链回滚到前一个区块。更妙的是，我们还构建了一种签出错误区块的区块生产者会被处罚的体系，这些区块生产者会因此丢失一个链上押金。

但是提交欺诈证明需要访问底层数据，即需要用之前的实际历史区块来证明欺诈。如果区块生产者为了防止爱丽丝能够向根节点合约提交欺诈证明，并不分享之前区块的信息怎么办？

在这种情况下，这个方案就是为了让爱丽丝收回资产并脱离子链而准备的。根本上来说，爱丽丝向根节点合约提交了一份“欺诈证明”。在一段任何人都可以质疑证明（比如，显示一些后面的合法区块证明实际上她消费了这些资产）的延迟时段后，爱丽丝的资产将会被移回到以太坊主链上。

最后，区块生产者可以监察子链中的用户。如果区块生产者愿意，他们可以直接不在其区块中不包含实际事务，从而有效阻止用户在子链上执行任何操作。如上所述，这个解决方案再一次的直接将我们所有的资产收回到以太坊主链上。

但是，取出资产本身也会带来风险。其中一个忧虑就是如果所有使用这一子链的用户在同一时刻都要取出资产会怎样。在这样一个大量取出的情况下，以太坊主链主链上可能没有足够的能力处理每个人在质疑期内的交易，也就意味着用户可能会失去资金。虽然有许多可行的技术能够防止这种情况发生，例如，通过延长质疑时间来适应取出资产的需求。

值得注意的是，所有区块生产者都是由一个实体控制这种情况并不是必定的，这只是我们案例中的极端个例。我们可以创建创建区块生产者分布在不同实体间的子链，即像公有区块一样真正地去中心化。在这些情况下，区块链生产者按照上述方式交互的风险更小，而且用户必须将资产转移回以太坊主链的风险也更小。

